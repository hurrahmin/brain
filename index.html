<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì˜ì–´ ë‹¨ì–´ ë°œìŒ í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        .subtitle {
            color: #666;
            font-size: 0.9em;
        }

        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            .header {
                padding: 30px;
                margin-bottom: 30px;
            }
            h1 {
                font-size: 2.5em;
            }
            .subtitle {
                font-size: 1.1em;
            }
        }

        .main-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        @media (min-width: 768px) {
            .main-content {
                padding: 40px;
            }
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 12px 30px;
            font-size: 1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            flex: 1;
            min-width: 120px;
        }

        @media (min-width: 768px) {
            .mode-selector {
                gap: 20px;
                margin-bottom: 30px;
            }
            .mode-btn {
                padding: 15px 40px;
                font-size: 1.2em;
                flex: initial;
            }
        }

        .mode-btn.student {
            background: #667eea;
            color: white;
        }

        .mode-btn.teacher {
            background: #f093fb;
            color: white;
        }

        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .mode-btn.active {
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .day-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        button {
            background: #667eea;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            -webkit-tap-highlight-color: transparent;
        }

        @media (min-width: 768px) {
            button {
                padding: 15px 30px;
                font-size: 1.1em;
            }
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .test-area {
            text-align: center;
        }

        .word-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            border-radius: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .word-display {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 15px;
            word-break: break-word;
        }

        .word-meaning {
            font-size: 1.2em;
            opacity: 0.9;
        }

        @media (min-width: 768px) {
            .word-card {
                padding: 60px;
                margin: 30px 0;
            }
            .word-display {
                font-size: 3em;
                margin-bottom: 20px;
            }
            .word-meaning {
                font-size: 1.5em;
            }
        }

        .progress-bar {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .mic-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #ff6b6b;
            border: none;
            font-size: 2.5em;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(255,107,107,0.4);
            margin: 20px auto;
            display: block;
            -webkit-tap-highlight-color: transparent;
        }

        @media (min-width: 768px) {
            .mic-button {
                width: 120px;
                height: 120px;
                font-size: 3em;
            }
        }

        .mic-button:hover {
            transform: scale(1.1);
        }

        .mic-button.listening {
            background: #51cf66;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .feedback {
            margin: 30px 0;
            padding: 25px;
            border-radius: 10px;
            font-size: 1.2em;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .accuracy-score {
            font-size: 2em;
            font-weight: bold;
            margin: 20px 0;
        }

        .results-summary {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            border-left: 5px solid #667eea;
        }

        .result-item.incorrect {
            border-left-color: #ff6b6b;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .controls button {
            flex: 1;
            min-width: 120px;
        }

        @media (min-width: 768px) {
            .controls {
                gap: 15px;
                flex-wrap: nowrap;
            }
            .controls button {
                flex: initial;
            }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .stat-label {
            margin-top: 5px;
            opacity: 0.9;
            font-size: 0.8em;
        }

        @media (min-width: 768px) {
            .stats {
                gap: 20px;
                margin: 30px 0;
            }
            .stat-card {
                padding: 25px;
            }
            .stat-value {
                font-size: 2.5em;
            }
            .stat-label {
                margin-top: 10px;
                font-size: 1em;
            }
        }

        .teacher-dashboard {
            margin-top: 30px;
        }

        .student-record {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .transcript-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
        }

        .hide {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š ì˜ì–´ ë‹¨ì–´ ë°œìŒ í…ŒìŠ¤íŠ¸</h1>
            <p class="subtitle">ëŠ¥ë¥  VOCA ì¤‘ë“± ê³ ë‚œë„ - AI ë°œìŒ ê²€ì‚¬ ì‹œìŠ¤í…œ</p>
        </div>

        <div class="main-content">
            <div class="mode-selector">
                <button class="mode-btn student active" onclick="switchMode('student')">ğŸ“ í•™ìƒ ëª¨ë“œ</button>
                <button class="mode-btn teacher" onclick="switchMode('teacher')">ğŸ‘¨â€ğŸ« ì„ ìƒë‹˜ ëª¨ë“œ</button>
            </div>

            <!-- í•™ìƒ ëª¨ë“œ -->
            <div id="studentMode" class="section active">
                <div id="setupScreen">
                    <div class="form-group">
                        <label>í•™ìƒ ì´ë¦„</label>
                        <input type="text" id="studentName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>

                    <div class="form-group">
                        <label>í…ŒìŠ¤íŠ¸í•  ë²”ìœ„ ì„ íƒ</label>
                        <div class="day-selector">
                            <div>
                                <label>ì‹œì‘ Day</label>
                                <select id="startDay"></select>
                            </div>
                            <div>
                                <label>ì¢…ë£Œ Day</label>
                                <select id="endDay"></select>
                            </div>
                        </div>
                    </div>

                    <button onclick="startTest()">í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
                </div>

                <div id="testScreen" class="section">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar">0%</div>
                    </div>

                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-value" id="currentIndex">0</div>
                            <div class="stat-label">í˜„ì¬ ë‹¨ì–´</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalWords">0</div>
                            <div class="stat-label">ì „ì²´ ë‹¨ì–´</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="correctCount">0</div>
                            <div class="stat-label">ë§ì¶˜ ë‹¨ì–´</div>
                        </div>
                    </div>

                    <div class="test-area">
                        <div class="word-card">
                            <div class="word-display" id="wordDisplay">ì¤€ë¹„ ì¤‘...</div>
                            <div class="word-meaning" id="wordMeaning"></div>
                        </div>

                        <button class="mic-button" id="micButton" onclick="startListening()">ğŸ¤</button>
                        <p style="color: #666; margin-top: 10px;" id="micInstruction">ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë°œìŒí•˜ì„¸ìš”</p>
                        <p style="color: #ff6b6b; font-weight: bold; margin-top: 5px;" id="attemptCounter" class="hide">ì‹œë„: <span id="attemptNum">0</span>/3</p>

                        <div id="transcriptDisplay" class="transcript-display hide">
                            ì¸ì‹ëœ ë°œìŒ: <span id="transcript"></span>
                        </div>

                        <div id="feedback" class="feedback hide"></div>

                        <div class="controls">
                            <button id="retryButton" onclick="retryWord()" style="display: none;">ğŸ”„ ë‹¤ì‹œ ì‹œë„</button>
                            <button id="nextButton" onclick="goToNextWord()" style="display: none;">â¡ï¸ ë‹¤ìŒ ë‹¨ì–´</button>
                            <button id="skipButton" onclick="skipWord()">â­ï¸ ê±´ë„ˆë›°ê¸°</button>
                            <button onclick="stopTest()">ğŸ›‘ í…ŒìŠ¤íŠ¸ ì¢…ë£Œ</button>
                        </div>
                    </div>
                </div>

                <div id="resultScreen" class="section">
                    <h2 style="text-align: center; margin-bottom: 30px;">í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
                    
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-value" id="finalCorrect">0</div>
                            <div class="stat-label">ì •ë‹µ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="finalIncorrect">0</div>
                            <div class="stat-label">ì˜¤ë‹µ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="finalScore">0%</div>
                            <div class="stat-label">ì •ë‹µë¥ </div>
                        </div>
                    </div>

                    <div class="results-summary" id="resultsList"></div>

                    <div class="controls">
                        <button onclick="downloadResults()">ğŸ“¥ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</button>
                        <button onclick="resetTest()">ğŸ”„ ìƒˆë¡œ ì‹œì‘</button>
                    </div>
                </div>
            </div>

            <!-- ì„ ìƒë‹˜ ëª¨ë“œ -->
            <div id="teacherMode" class="section">
                <h2>í•™ìƒ í…ŒìŠ¤íŠ¸ ê¸°ë¡</h2>
                <div class="teacher-dashboard" id="teacherDashboard">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        ì €ì¥ëœ í…ŒìŠ¤íŠ¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                    </p>
                </div>
                <div class="controls">
                    <button onclick="loadAllRecords()">ğŸ”„ ê¸°ë¡ ìƒˆë¡œê³ ì¹¨</button>
                    <button onclick="clearAllRecords()">ğŸ—‘ï¸ ëª¨ë“  ê¸°ë¡ ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentMode = 'student';
        let recognition;
        let isListening = false;
        let currentWordIndex = 0;
        let testWords = [];
        let testResults = [];
        let studentName = '';
        let attemptCount = 0; // í˜„ì¬ ë‹¨ì–´ ì‹œë„ íšŸìˆ˜
        let maxAttempts = 3; // ìµœëŒ€ ì‹œë„ íšŸìˆ˜

        // ë‹¨ì–´ ë°ì´í„° (DAY01-20)
        const vocabData = {
            'DAY01': [
                {word: 'jealous', meaning: 'ì§ˆíˆ¬í•˜ëŠ”, ì‹œê¸°í•˜ëŠ”'},
                {word: 'nearby', meaning: 'ì¸ê·¼ì˜, ê°€ê¹Œìš´ ê³³ì˜'},
                {word: 'overseas', meaning: 'í•´ì™¸ë¡œ, í•´ì™¸ì—ì„œ'},
                {word: 'inform', meaning: 'ì•Œë¦¬ë‹¤, í†µì§€í•˜ë‹¤'},
                {word: 'historical', meaning: 'ì—­ì‚¬ì˜, ì—­ì‚¬ì ì¸'},
                {word: 'screen', meaning: 'í™”ë©´, ìŠ¤í¬ë¦°, ì˜í™”'},
                {word: 'concept', meaning: 'ê°œë…'},
                {word: 'employ', meaning: 'ê³ ìš©í•˜ë‹¤'},
                {word: 'broad', meaning: '(í­ì´) ë„“ì€, í­ë„“ì€, ê´‘ë²”ìœ„í•œ'},
                {word: 'unusual', meaning: 'ë³´í†µì´ ì•„ë‹Œ, í”ì¹˜ ì•Šì€, ë…íŠ¹í•œ'},
                {word: 'remain', meaning: 'ì—¬ì „íˆ[ê³„ì†] ...ì´ë‹¤, ë‚¨ë‹¤'},
                {word: 'lecture', meaning: 'ê°•ì˜, ê°•ì—°'},
                {word: 'league', meaning: '(ìŠ¤í¬ì¸  ê²½ê¸°ì˜) ë¦¬ê·¸, ì—°í•©, ì—°ë§¹'},
                {word: 'reality', meaning: 'í˜„ì‹¤, ì‹¤ì œìƒí™©'},
                {word: 'relief', meaning: 'ì•ˆë„, ì•ˆì‹¬, (ê³ í†µ ë“±ì˜) ê²½ê°, ì™„í™”'},
                {word: 'eager', meaning: 'ê°„ì ˆíˆ ë°”ë¼ëŠ”, ê°ˆë§í•˜ëŠ”'},
                {word: 'state', meaning: 'ìƒíƒœ, í˜•í¸, (ë¯¸êµ­ ë“±ì˜) ì£¼'},
                {word: 'complex', meaning: 'ë³µì¡í•œ'},
                {word: 'curve', meaning: 'ê³¡ì„ , ì»¤ë¸Œ'},
                {word: 'criticize', meaning: 'ë¹„ë‚œ[ë¹„íŒ]í•˜ë‹¤, ë¹„í‰í•˜ë‹¤'},
                {word: 'relationship', meaning: 'ê´€ê³„, ê´€ë ¨'},
                {word: 'stream', meaning: 'ì‹œë‚´, ì‹œëƒ‡ë¬¼, íë¦„'},
                {word: 'bandage', meaning: 'ë¶•ëŒ€'},
                {word: 'memorable', meaning: 'ê¸°ì–µí•  ë§Œí•œ, ì¸ìƒì ì¸'},
                {word: 'treatment', meaning: 'ì¹˜ë£Œ, ì²˜ì¹˜, ëŒ€ìš°'},
                {word: 'apply', meaning: 'ì§€ì›[ì‹ ì²­]í•˜ë‹¤, ì ìš©[í•´ë‹¹]ë˜ë‹¤, ì ìš©í•˜ë‹¤'},
                {word: 'earn', meaning: '(ëˆì„) ë²Œë‹¤'},
            ],
            'DAY02': [
                {word: 'foresee', meaning: 'ì˜ˆê²¬í•˜ë‹¤, ì˜ˆì¸¡í•˜ë‹¤'},
                {word: 'grammar', meaning: 'ë¬¸ë²•'},
                {word: 'lend', meaning: 'ë¹Œë ¤ì£¼ë‹¤'},
                {word: 'passenger', meaning: 'ìŠ¹ê°, ì—¬ê°'},
                {word: 'admire', meaning: 'ì¡´ê²½í•˜ë‹¤'},
                {word: 'ashamed', meaning: 'ë¶€ë„ëŸ¬ìš´, ìˆ˜ì¹˜ìŠ¤ëŸ¬ìš´'},
                {word: 'merry', meaning: 'ëª…ë‘í•œ, ì¦ê±°ìš´'},
                {word: 'industry', meaning: 'ê³µì—…, ì‚°ì—…'},
                {word: 'trend', meaning: 'ê²½í–¥, ì¶”ì„¸, ìœ í–‰'},
                {word: 'efficient', meaning: 'íš¨ìœ¨ì ì¸, ìœ ëŠ¥í•œ'},
                {word: 'remind', meaning: 'ìƒê¸°ì‹œí‚¤ë‹¤, ìƒê°ë‚˜ê²Œ í•˜ë‹¤'},
                {word: 'except', meaning: '...ì„ ì œì™¸í•˜ê³ , ... ì´ì™¸ì—ëŠ”'},
                {word: 'switch', meaning: 'ìŠ¤ìœ„ì¹˜, ë³€ê²½, ì „í™˜'},
                {word: 'eventually', meaning: 'ê²°êµ­, ì¢…ë‚´'},
                {word: 'task', meaning: 'ì§ë¬´, ê³¼ì œ'},
                {word: 'limit', meaning: 'í•œê³„, ì œí•œ'},
                {word: 'maintain', meaning: 'ì§€ì†[ê³„ì†]í•˜ë‹¤, ìœ ì§€í•˜ë‹¤'},
                {word: 'session', meaning: '(íŠ¹ì •í•œ í™œë™ì„ í•˜ëŠ”) ê¸°ê°„[ì‹œê°„]'},
                {word: 'unbelievable', meaning: 'ë¯¿ê¸° ì–´ë ¤ìš´, ë¯¿ì„ ìˆ˜ ì—†ëŠ”'},
                {word: 'advantage', meaning: 'ìœ ë¦¬í•œ ì , ì´ì , ì¥ì '},
                {word: 'terribly', meaning: 'ë§¤ìš°, ëª¹ì‹œ, ì•„ì£¼, ë‚˜ì˜ê²Œ, ì§€ë…í•˜ê²Œ'},
                {word: 'desire', meaning: 'ìš•êµ¬, ê°ˆë§'},
                {word: 'uneasy', meaning: 'ë¶ˆì•ˆí•œ, ê±±ì •ë˜ëŠ”, ë¶ˆí¸í•œ'},
                {word: 'essence', meaning: 'ë³¸ì§ˆ, ì§„ìˆ˜'},
                {word: 'priceless', meaning: 'ê°’ì„ ë§¤ê¸¸ ìˆ˜ ì—†ëŠ”, ë§¤ìš° ê·€ì¤‘í•œ'},
                {word: 'emergency', meaning: 'ë¹„ìƒì‚¬íƒœ, ë¹„ìƒì‹œ'},
            ],
            'DAY03': [
                {word: 'anxiety', meaning: 'ê±±ì •, ë¶ˆì•ˆ'},
                {word: 'setting', meaning: 'í™˜ê²½, ì¥ì†Œ, (ì†Œì„¤, ì˜í™” ë“±ì˜) ë°°ê²½, ë¬´ëŒ€'},
                {word: 'imagination', meaning: 'ìƒìƒ(ë ¥)'},
                {word: 'therapy', meaning: 'ì¹˜ë£Œ, ìš”ë²•'},
                {word: 'experiment', meaning: 'ì‹¤í—˜'},
                {word: 'snore', meaning: 'ì½”ë¥¼ ê³¨ë‹¤'},
                {word: 'overall', meaning: 'ì „ì²´ì˜, ì „ë°˜ì ì¸'},
                {word: 'hire', meaning: 'ê³ ìš©í•˜ë‹¤'},
                {word: 'regret', meaning: 'í›„íšŒí•˜ë‹¤'},
                {word: 'anniversary', meaning: 'ê¸°ë…ì¼'},
                {word: 'entertain', meaning: 'ì¦ê²ê²Œ í•˜ë‹¤'},
                {word: 'absolute', meaning: 'ì™„ë²½í•œ, ì™„ì „í•œ, ì ˆëŒ€ì ì¸, ë¬´ì œí•œì˜'},
                {word: 'aim', meaning: 'ëª©í‘œë¡œ í•˜ë‹¤, ê²¨ëˆ„ë‹¤'},
                {word: 'sincere', meaning: 'ì§„ì‹¤ëœ, ì§„ì‹¬ ì–´ë¦°'},
                {word: 'therefore', meaning: 'ê·¸ëŸ¬ë¯€ë¡œ, ê·¸ ê²°ê³¼'},
                {word: 'audience', meaning: 'ì²­ì¤‘, ê´€ê°'},
                {word: 'valuable', meaning: 'ê°€ì¹˜ê°€ í°, ê°’ë¹„ì‹¼, ìœ ìµí•œ, ì†Œì¤‘í•œ'},
                {word: 'underwater', meaning: 'ë¬¼ì†ì˜, ìˆ˜ì¤‘(ìš©)ì˜'},
                {word: 'deserve', meaning: '...í• [ë°›ì„] ë§Œí•˜ë‹¤, ...í•  ê°€ì¹˜ê°€ ìˆë‹¤'},
                {word: 'sneeze', meaning: 'ì¬ì±„ê¸°í•˜ë‹¤'},
                {word: 'realistic', meaning: 'í˜„ì‹¤ì ì¸, í˜„ì‹¤ì„± ìˆëŠ”, ì‚¬ì‹¤ì ì¸'},
                {word: 'ideal', meaning: 'ì´ìƒì ì¸, ì™„ë²½í•œ'},
                {word: 'furthermore', meaning: 'ë”ìš±ì´, ê²Œë‹¤ê°€'},
                {word: 'faith', meaning: 'ë¯¿ìŒ, ì‹ ë¢°'},
                {word: 'suggest', meaning: 'ì œì•ˆ[ì¶”ì²œ]í•˜ë‹¤, ì‹œì‚¬í•˜ë‹¤'},
                {word: 'spark', meaning: 'ë¶ˆê½ƒ'},
                {word: 'plenty', meaning: 'ë§ìŒ, ì¶©ë¶„'},
            ]
        };

        // ì´ˆê¸°í™”
        function init() {
            populateDaySelectors();
            setupSpeechRecognition();
            loadTeacherRecords();
        }

        // Day ì„ íƒ ì˜µì…˜ ìƒì„±
        function populateDaySelectors() {
            const startSelect = document.getElementById('startDay');
            const endSelect = document.getElementById('endDay');
            
            for (let i = 1; i <= 20; i++) {
                const option1 = document.createElement('option');
                option1.value = i;
                option1.textContent = `Day ${i}`;
                startSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = i;
                option2.textContent = `Day ${i}`;
                endSelect.appendChild(option2);
            }

            endSelect.value = 2; // ê¸°ë³¸ê°’: Day 1-2
        }

        // ìŒì„± ì¸ì‹ ì„¤ì •
        function setupSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.lang = 'en-US';
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.toLowerCase().trim();
                    processRecognition(transcript);
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    document.getElementById('micButton').classList.remove('listening');
                    isListening = false;
                    
                    if (event.error === 'not-allowed') {
                        alert('âš ï¸ ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤!\n\ní•´ê²° ë°©ë²•:\n\n1. ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ ì™¼ìª½ì˜ ğŸ”’ ë˜ëŠ” â“˜ ì•„ì´ì½˜ì„ í´ë¦­í•˜ì„¸ìš”\n2. "ë§ˆì´í¬" ê¶Œí•œì„ "í—ˆìš©"ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”\n3. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”\n\në˜ëŠ”\n\ní¬ë¡¬ ì„¤ì • > ê°œì¸ì •ë³´ ë° ë³´ì•ˆ > ì‚¬ì´íŠ¸ ì„¤ì • > ë§ˆì´í¬ì—ì„œ ì´ ì‚¬ì´íŠ¸ë¥¼ í—ˆìš© ëª©ë¡ì— ì¶”ê°€í•˜ì„¸ìš”.');
                    } else if (event.error === 'no-speech') {
                        alert('ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    } else if (event.error === 'aborted') {
                        // ì‚¬ìš©ìê°€ ì¤‘ë‹¨í•œ ê²½ìš° - ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
                        return;
                    } else {
                        alert('ìŒì„± ì¸ì‹ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + event.error + '\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    }
                };

                recognition.onend = function() {
                    document.getElementById('micButton').classList.remove('listening');
                    isListening = false;
                };
            } else {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
            }
        }

        // ëª¨ë“œ ì „í™˜
        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('studentMode').classList.toggle('active', mode === 'student');
            document.getElementById('teacherMode').classList.toggle('active', mode === 'teacher');
            
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.mode-btn.${mode}`).classList.add('active');

            if (mode === 'teacher') {
                loadTeacherRecords();
            }
        }

        // í…ŒìŠ¤íŠ¸ ì‹œì‘
        function startTest() {
            studentName = document.getElementById('studentName').value.trim();
            if (!studentName) {
                alert('í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const startDay = parseInt(document.getElementById('startDay').value);
            const endDay = parseInt(document.getElementById('endDay').value);

            if (endDay < startDay) {
                alert('ì¢…ë£Œ DayëŠ” ì‹œì‘ Dayë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            if (endDay - startDay > 2) {
                alert('ìµœëŒ€ 3ì¼ì¹˜ê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            // ì„ íƒëœ Dayì˜ ë‹¨ì–´ë“¤ ìˆ˜ì§‘
            testWords = [];
            for (let i = startDay; i <= endDay; i++) {
                const dayKey = `DAY${String(i).padStart(2, '0')}`;
                if (vocabData[dayKey]) {
                    testWords = testWords.concat(vocabData[dayKey]);
                }
            }

            if (testWords.length === 0) {
                alert('ì„ íƒí•œ ë²”ìœ„ì˜ ë‹¨ì–´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ë‹¨ì–´ ì„ê¸°
            testWords = shuffleArray(testWords);
            
            currentWordIndex = 0;
            testResults = [];

            document.getElementById('setupScreen').classList.remove('active');
            document.getElementById('testScreen').classList.add('active');
            document.getElementById('totalWords').textContent = testWords.length;

            showNextWord();
        }

        // ë°°ì—´ ì„ê¸°
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // ë‹¤ìŒ ë‹¨ì–´ í‘œì‹œ
        function showNextWord() {
            if (currentWordIndex >= testWords.length) {
                finishTest();
                return;
            }

            attemptCount = 0; // ì‹œë„ íšŸìˆ˜ ì´ˆê¸°í™”

            const word = testWords[currentWordIndex];
            document.getElementById('wordDisplay').textContent = word.word;
            document.getElementById('wordMeaning').textContent = word.meaning;
            document.getElementById('currentIndex').textContent = currentWordIndex + 1;
            
            const progress = ((currentWordIndex) / testWords.length) * 100;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';

            document.getElementById('feedback').classList.add('hide');
            document.getElementById('transcriptDisplay').classList.add('hide');
            document.getElementById('attemptCounter').classList.add('hide');
            document.getElementById('nextButton').style.display = 'none';
            document.getElementById('retryButton').style.display = 'none';
            document.getElementById('skipButton').style.display = 'inline-block';
            document.getElementById('micButton').disabled = false;
            document.getElementById('micInstruction').textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë°œìŒí•˜ì„¸ìš”';
        }

        // ìŒì„± ì¸ì‹ ì‹œì‘
        function startListening() {
            if (!recognition) {
                alert('ìŒì„± ì¸ì‹ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
                return;
            }

            if (isListening) return;

            isListening = true;
            document.getElementById('micButton').classList.add('listening');
            recognition.start();
        }

        // ë°œìŒ ì²˜ë¦¬
        function processRecognition(transcript) {
            attemptCount++;
            
            const currentWord = testWords[currentWordIndex];
            const correctWord = currentWord.word.toLowerCase();
            
            document.getElementById('transcript').textContent = transcript;
            document.getElementById('transcriptDisplay').classList.remove('hide');

            // ìœ ì‚¬ë„ ê³„ì‚° (ê°„ë‹¨í•œ ë§¤ì¹­)
            const isCorrect = transcript === correctWord || 
                             transcript.includes(correctWord) ||
                             calculateSimilarity(transcript, correctWord) > 0.7;

            const feedback = document.getElementById('feedback');
            feedback.classList.remove('hide', 'correct', 'incorrect');

            if (isCorrect) {
                // ì •ë‹µì¸ ê²½ìš°
                feedback.classList.add('correct');
                feedback.innerHTML = `
                    <div style="font-size: 2em; margin-bottom: 10px;">âœ… ì •í™•í•©ë‹ˆë‹¤!</div>
                    <div>ë°œìŒ: ${transcript}</div>
                    <div style="margin-top: 10px; color: #155724;">ì‹œë„ íšŸìˆ˜: ${attemptCount}íšŒ</div>
                `;
                testResults.push({
                    word: currentWord.word,
                    meaning: currentWord.meaning,
                    userInput: transcript,
                    attempts: attemptCount,
                    correct: true
                });
                document.getElementById('correctCount').textContent = testResults.filter(r => r.correct).length;
                
                // ë‹¤ìŒ ë‹¨ì–´ ë²„íŠ¼ë§Œ í‘œì‹œ
                document.getElementById('nextButton').style.display = 'inline-block';
                document.getElementById('retryButton').style.display = 'none';
                document.getElementById('skipButton').style.display = 'none';
                document.getElementById('micButton').disabled = true;
                document.getElementById('attemptCounter').classList.add('hide');
                
            } else {
                // ì˜¤ë‹µì¸ ê²½ìš°
                feedback.classList.add('incorrect');
                
                if (attemptCount >= maxAttempts) {
                    // 3ë²ˆ ì‹¤íŒ¨í•œ ê²½ìš°
                    feedback.innerHTML = `
                        <div style="font-size: 2em; margin-bottom: 10px;">ğŸ˜¢ 3ë²ˆ ì‹œë„í–ˆìŠµë‹ˆë‹¤</div>
                        <div>ë§ˆì§€ë§‰ ë°œìŒ: ${transcript}</div>
                        <div style="margin-top: 10px;">ì •ë‹µ: <strong>${correctWord}</strong></div>
                        <div style="margin-top: 10px; color: #721c24;">ë‹¤ìŒ ë‹¨ì–´ë¡œ ë„˜ì–´ê°€ì„¸ìš”</div>
                    `;
                    testResults.push({
                        word: currentWord.word,
                        meaning: currentWord.meaning,
                        userInput: transcript,
                        attempts: attemptCount,
                        correct: false
                    });
                    
                    // ë‹¤ìŒ ë‹¨ì–´ ë²„íŠ¼ í‘œì‹œ, ë‹¤ì‹œ ì‹œë„ ë²„íŠ¼ ìˆ¨ê¹€
                    document.getElementById('nextButton').style.display = 'inline-block';
                    document.getElementById('retryButton').style.display = 'none';
                    document.getElementById('skipButton').style.display = 'none';
                    document.getElementById('micButton').disabled = true;
                    document.getElementById('attemptCounter').classList.add('hide');
                    
                } else {
                    // ì•„ì§ ì‹œë„ ê¸°íšŒê°€ ë‚¨ì€ ê²½ìš°
                    feedback.innerHTML = `
                        <div style="font-size: 2em; margin-bottom: 10px;">âŒ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”</div>
                        <div>ì¸ì‹ëœ ë°œìŒ: ${transcript}</div>
                        <div>ì •ë‹µ: <strong>${correctWord}</strong></div>
                        <div style="margin-top: 10px; color: #721c24;">ë‚¨ì€ ê¸°íšŒ: ${maxAttempts - attemptCount}ë²ˆ</div>
                    `;
                    
                    // ì‹œë„ ì¹´ìš´í„° í‘œì‹œ
                    document.getElementById('attemptNum').textContent = attemptCount;
                    document.getElementById('attemptCounter').classList.remove('hide');
                    
                    // ë‹¤ì‹œ ì‹œë„ ë²„íŠ¼ í‘œì‹œ
                    document.getElementById('retryButton').style.display = 'inline-block';
                    document.getElementById('nextButton').style.display = 'none';
                    document.getElementById('skipButton').style.display = 'none';
                    document.getElementById('micButton').disabled = true;
                }
            }
        }

        // ë‹¤ì‹œ ì‹œë„
        function retryWord() {
            document.getElementById('feedback').classList.add('hide');
            document.getElementById('transcriptDisplay').classList.add('hide');
            document.getElementById('retryButton').style.display = 'none';
            document.getElementById('micButton').disabled = false;
            document.getElementById('micInstruction').textContent = `ë‹¤ì‹œ ë°œìŒí•´ë³´ì„¸ìš” (${attemptCount}/${maxAttempts})`;
        }

        // ë‹¤ìŒ ë‹¨ì–´ë¡œ ì´ë™
        function goToNextWord() {
            currentWordIndex++;
            showNextWord();
        }

        // ë¬¸ìì—´ ìœ ì‚¬ë„ ê³„ì‚° (Levenshtein distance)
        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = getEditDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }

        function getEditDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        // ë‹¨ì–´ ê±´ë„ˆë›°ê¸°
        function skipWord() {
            const currentWord = testWords[currentWordIndex];
            testResults.push({
                word: currentWord.word,
                meaning: currentWord.meaning,
                userInput: '(ê±´ë„ˆëœ€)',
                attempts: 0,
                correct: false
            });
            currentWordIndex++;
            showNextWord();
        }

        // í…ŒìŠ¤íŠ¸ ì¤‘ë‹¨
        function stopTest() {
            if (confirm('í…ŒìŠ¤íŠ¸ë¥¼ ì¤‘ë‹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                finishTest();
            }
        }

        // í…ŒìŠ¤íŠ¸ ì™„ë£Œ
        function finishTest() {
            document.getElementById('testScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.add('active');

            const correctAnswers = testResults.filter(r => r.correct).length;
            const totalQuestions = testResults.length;
            const score = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;

            document.getElementById('finalCorrect').textContent = correctAnswers;
            document.getElementById('finalIncorrect').textContent = totalQuestions - correctAnswers;
            document.getElementById('finalScore').textContent = score + '%';

            // ê²°ê³¼ ëª©ë¡ ìƒì„±
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '<h3 style="margin-bottom: 20px;">ìƒì„¸ ê²°ê³¼</h3>';
            
            testResults.forEach((result, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = `result-item ${result.correct ? '' : 'incorrect'}`;
                const attemptInfo = result.attempts > 0 ? ` (${result.attempts}ë²ˆ ì‹œë„)` : '';
                resultItem.innerHTML = `
                    <div>
                        <strong>${index + 1}. ${result.word}</strong> - ${result.meaning}
                        <div style="color: #666; font-size: 0.9em; margin-top: 5px;">
                            ë°œìŒ: ${result.userInput}${attemptInfo}
                        </div>
                    </div>
                    <div style="font-size: 1.5em;">
                        ${result.correct ? 'âœ…' : 'âŒ'}
                    </div>
                `;
                resultsList.appendChild(resultItem);
            });

            // ê²°ê³¼ ì €ì¥
            saveTestResult({
                studentName: studentName,
                date: new Date().toLocaleString('ko-KR'),
                totalWords: totalQuestions,
                correct: correctAnswers,
                score: score,
                details: testResults
            });
        }

        // ê²°ê³¼ ì €ì¥
        function saveTestResult(result) {
            let records = JSON.parse(localStorage.getItem('vocabTestRecords') || '[]');
            records.push(result);
            localStorage.setItem('vocabTestRecords', JSON.stringify(records));
        }

        // ê²°ê³¼ ë‹¤ìš´ë¡œë“œ
        function downloadResults() {
            const correctAnswers = testResults.filter(r => r.correct).length;
            const totalQuestions = testResults.length;
            const score = Math.round((correctAnswers / totalQuestions) * 100);

            let csvContent = 'ë²ˆí˜¸,ë‹¨ì–´,ëœ»,ë°œìŒ,ì‹œë„íšŸìˆ˜,ê²°ê³¼\n';
            testResults.forEach((result, index) => {
                csvContent += `${index + 1},"${result.word}","${result.meaning}","${result.userInput}",${result.attempts || 0},"${result.correct ? 'ì •ë‹µ' : 'ì˜¤ë‹µ'}"\n`;
            });
            csvContent += `\nì´ ë‹¨ì–´ ìˆ˜,${totalQuestions}\n`;
            csvContent += `ì •ë‹µ ìˆ˜,${correctAnswers}\n`;
            csvContent += `ì •ë‹µë¥ ,${score}%\n`;

            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${studentName}_ë°œìŒí…ŒìŠ¤íŠ¸_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”
        function resetTest() {
            document.getElementById('resultScreen').classList.remove('active');
            document.getElementById('setupScreen').classList.add('active');
            document.getElementById('studentName').value = '';
            document.getElementById('startDay').value = '1';
            document.getElementById('endDay').value = '2';
            currentWordIndex = 0;
            testWords = [];
            testResults = [];
        }

        // ì„ ìƒë‹˜ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadTeacherRecords() {
            const records = JSON.parse(localStorage.getItem('vocabTestRecords') || '[]');
            const dashboard = document.getElementById('teacherDashboard');

            if (records.length === 0) {
                dashboard.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ì €ì¥ëœ í…ŒìŠ¤íŠ¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            dashboard.innerHTML = '';
            records.reverse().forEach((record, index) => {
                const recordDiv = document.createElement('div');
                recordDiv.className = 'student-record';
                recordDiv.innerHTML = `
                    <h3>${record.studentName}</h3>
                    <p style="color: #666; margin: 10px 0;">í…ŒìŠ¤íŠ¸ ì¼ì‹œ: ${record.date}</p>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">${record.totalWords}</div>
                            <div style="color: #666; font-size: 0.9em;">ì´ ë‹¨ì–´</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #51cf66;">${record.correct}</div>
                            <div style="color: #666; font-size: 0.9em;">ì •ë‹µ</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #ff6b6b;">${record.totalWords - record.correct}</div>
                            <div style="color: #666; font-size: 0.9em;">ì˜¤ë‹µ</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">${record.score}%</div>
                            <div style="color: #666; font-size: 0.9em;">ì •ë‹µë¥ </div>
                        </div>
                    </div>
                    <details style="margin-top: 15px;">
                        <summary style="cursor: pointer; color: #667eea; font-weight: bold;">ìƒì„¸ ê²°ê³¼ ë³´ê¸°</summary>
                        <div style="margin-top: 15px;" id="details-${index}"></div>
                    </details>
                `;
                dashboard.appendChild(recordDiv);

                // ìƒì„¸ ê²°ê³¼ ì¶”ê°€
                const detailsDiv = recordDiv.querySelector(`#details-${index}`);
                record.details.forEach((detail, idx) => {
                    const detailItem = document.createElement('div');
                    detailItem.style.cssText = 'padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; display: flex; justify-content: space-between;';
                    detailItem.innerHTML = `
                        <div>
                            <strong>${idx + 1}. ${detail.word}</strong> - ${detail.meaning}
                            <div style="color: #666; font-size: 0.9em;">ë°œìŒ: ${detail.userInput}</div>
                        </div>
                        <div style="font-size: 1.2em;">${detail.correct ? 'âœ…' : 'âŒ'}</div>
                    `;
                    detailsDiv.appendChild(detailItem);
                });
            });
        }

        // ëª¨ë“  ê¸°ë¡ ìƒˆë¡œê³ ì¹¨
        function loadAllRecords() {
            loadTeacherRecords();
            alert('ê¸°ë¡ì„ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤.');
        }

        // ëª¨ë“  ê¸°ë¡ ì‚­ì œ
        function clearAllRecords() {
            if (confirm('ì •ë§ ëª¨ë“  í…ŒìŠ¤íŠ¸ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('vocabTestRecords');
                loadTeacherRecords();
                alert('ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = init;
    </script>
</body>
</html>
